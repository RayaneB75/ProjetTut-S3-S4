version:  '3.8'

networks:
  vnet:
    ipam:
      driver: bridge
      config:
        - subnet: "172.17.0.0/16"

services:
## Portainer = Gestion des containers docker ##
  portainer:
    image: portainer/portainer-ce:latest
    ports:
      - 9000:9000
      - 8000:8000
      - 9443:9443
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /volume1/docker/projet-tutore/portainer:/data
      - /volume1/docker/projet-tutore/shared:/shared
    command: -H unix:///var/run/docker.sock
    networks:
      vnet:
        ipv4_address: 172.17.0.5

## Serveur PHP+PhpMyAdmin via Xampp ##
  www:
    image: tomsik68/xampp:8
    restart: unless-stopped
    ports:
      - 1443:1443
      - 180:180
      - 41061:22
    volumes:
      - /volume1/docker/rayane/projet-tut/www:/www
    networks:
      vnet:
        ipv4_address: 172.17.0.3

## Serveur VPN via OpenVPN ##
    #sudo docker run -d --name openvpn -v ~/openvpn/data:/etc/openvpn --log-driver=none --rm kylemanna/openvpn ovpn_genconfig -u udp://vpn.rayane.space
  openvpn:
    image: kylemanna/openvpn:latest
    container_name: openvpn
    ports:
      - 1194:1194/udp
    volumes:
      - /volume1/docker/rayane/openvpn/data:/etc/openvpn
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    networks:
      vnet:
        ipv4_address: 172.17.0.4

## Serveur DNS via bind9 ##
  ns:
    image: internetsystemsconsortium/bind9:9.16  #9.16 est la derni√®re version stable
    restart: unless-stopped
    ports:
      - 53:53/udp
      - 53:53/tcp
      - 953:953/tcp
    networks:
      vnet:
        ipv4_address: 172.17.0.2
